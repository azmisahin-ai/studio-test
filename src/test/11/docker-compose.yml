# docker-compose.yml
services:
  development:

    build:
      context: .
      dockerfile: Dockerfile
      target: development

    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities:
                - gpu
          cpus: "0.25"
          memory: 2GiB

    volumes: 
      - workspaces-development:/workspaces

    # command: ["/bin/bash", "-c", "while true; do sleep 1; done"]

    environment:
      - FLASK_ENV=development 
      - DEBUG=true
      - FLASK_RUN_HOST=0.0.0.0
      - FLASK_RUN_PORT=5000
    ports:
      - "5000:5000"      

  production:

    build:
      context: .
      dockerfile: Dockerfile
      target: production

    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities:
                - gpu
          cpus: "0.25"
          memory: 2GiB

    volumes: 
      - workspaces-production:/workspaces

    # command: ["/bin/bash", "-c", "while true; do sleep 1; done"]

    environment:
      - FLASK_ENV=production 
      - DEBUG=false
      - FLASK_RUN_HOST=0.0.0.0
      - FLASK_RUN_PORT=80
    ports:
      - "80:80"   

volumes:
  workspaces-development:
    driver: local
  workspaces-production:
    driver: local    